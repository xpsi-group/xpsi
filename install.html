

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation &mdash; x-psi 3.2.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=eb155f5e"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Overview" href="overview.html" />
    <link rel="prev" title="X-ray Pulse Simulation and Inference (X-PSI)" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            x-psi
              <img src="_static/xpsilogo_small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisite-python-packages">Prerequisite Python Packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#conda-environment">Conda Environment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#prerequisite-non-python-packages-and-pymultinest">Prerequisite Non-Python Packages and PyMultiNest</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#multinest">MultiNest</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#x-psi">X-PSI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tips-for-installing-on-mac-os">Tips for installing on Mac OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tips-for-installing-on-windows">Tips for installing on Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQs and common problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="HPC_systems.html">HPC systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">Future</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Team and acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Start_here.html">Start here</a></li>
<li class="toctree-l1"><a class="reference internal" href="XPSI_101.html">X-PSI 101 - For Beginners</a></li>
<li class="toctree-l1"><a class="reference internal" href="Modeling.html">Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Instrument_synergy.html">Instrument synergy</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hot_region_complexity.html">Hot region complexity</a></li>
<li class="toctree-l1"><a class="reference internal" href="Global_surface_emission.html">Global surface emission</a></li>
<li class="toctree-l1"><a class="reference internal" href="Surface_radiation_field_tools.html">Surface radiation field tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Modeling_without_statistics.html">Modeling (without statistics)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Polarization.html">Polarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Post-processing.html">Post-processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Emitting_patterns_2Dprojection.html">Emitting Patterns 2D Projection</a></li>
<li class="toctree-l1"><a class="reference internal" href="Accretion_disk.html">Accretion disk</a></li>
<li class="toctree-l1"><a class="reference internal" href="Multiple_imaging.html">Multiple imaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Importance_sampling.html">Importance Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Module_generator_tutorial.html">Module generator tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example_script_and_modules.html">Example script and modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example_job.html">Example job</a></li>
<li class="toctree-l1"><a class="reference internal" href="x_p_sbi.html">Posterior Inference using SBI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="likelihood_api.html">Likelihood API</a></li>
<li class="toctree-l1"><a class="reference internal" href="extension_modules.html">Extension modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="posterior_api.html">Posterior API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">x-psi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/install.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installation">
<span id="install"></span><h1>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h1>
<p>X-PSI is an open-source software package that is available on <a class="reference external" href="https://github.com/xpsi-group/xpsi.git">GitHub</a> and can be cloned as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/xpsi-group/xpsi.git<span class="w"> </span>&lt;/path/to/xpsi&gt;
</pre></div>
</div>
<p>In this page, we lay down the instructions for installing X-PSI and all the
necessary prerequisites on your local self-administered system.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For installation on a high-performance computing system, we direct the
reader to the <a class="reference internal" href="HPC_systems.html#hpcsystems"><span class="std std-ref">HPC systems</span></a> page for guidance since the instructions
on this page are either not applicable or do not target performance.</p>
</div>
<section id="prerequisite-python-packages">
<span id="dev-env"></span><h2>Prerequisite Python Packages<a class="headerlink" href="#prerequisite-python-packages" title="Link to this heading"></a></h2>
<p>X-PSI was originally developed in Python 2.7 and was ported to Python 3 as of
X-PSI v2.0. We recommend creating a conda virtual environment with anaconda3 as
per instructions below so as to not disrupt your Python ecosystem.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">&gt;=</span> <span class="pre">3.9.0</span></code> is now required because of the version of
<code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> needed.</p>
<section id="conda-environment">
<span id="basic-env"></span><h3>Conda Environment<a class="headerlink" href="#conda-environment" title="Link to this heading"></a></h3>
<p>In the source directory we provide a dependency file <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> that
installs the Python packages required for basic functionality of X-PSI. Note
the script requirement for <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>.  For now, we leave out the
multinest/ultranest samplers, because of issues on MacOS.  Details for installation
of those are below.</p>
<p>The content of the <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> are:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>name:<span class="w"> </span>xpsi
channels:
<span class="w">    </span>-<span class="w"> </span>defaults
<span class="w">    </span>-<span class="w"> </span>conda-forge
dependencies:
<span class="w">    </span>-<span class="w"> </span>python<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">3</span>.9.0
<span class="w">    </span>-<span class="w"> </span>numpy<span class="w"> </span>&lt;<span class="w"> </span><span class="m">2</span>.0.0
<span class="w">    </span>-<span class="w"> </span>cython~<span class="o">=</span><span class="w"> </span><span class="m">3</span>.0.11
<span class="w">    </span>-<span class="w"> </span><span class="nv">matplotlib</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">3</span>.9.2<span class="w">       </span><span class="c1"># STRICT REQUIREMENT FROM FGIVENX</span>
<span class="w">    </span>-<span class="w"> </span>scipy
<span class="w">    </span>-<span class="w"> </span>wrapt
<span class="w">    </span>-<span class="w"> </span>gsl<span class="w">                       </span><span class="c1"># GNU Science library</span>
<span class="w">    </span>-<span class="w"> </span>pytest<span class="w">                    </span><span class="c1"># running functionality self-tests</span>
<span class="w">    </span>-<span class="w"> </span>getdist<span class="w">                   </span><span class="c1"># posterior KDE corner plotting</span>
<span class="w">    </span>-<span class="w"> </span>tqdm<span class="w">                      </span><span class="c1"># progress bar package</span>
<span class="w">    </span>-<span class="w"> </span>h5py<span class="w">                      </span><span class="c1"># storage of X-ray signals computed from posterior samples</span>
<span class="w">    </span>-<span class="w"> </span>nestcheck<span class="w">                 </span><span class="c1"># posterior error analysis, plotting, run combination, etc.</span>
<span class="w">    </span>-<span class="w"> </span>fgivenx<span class="w">                   </span><span class="c1"># conditional posterior plotting; also required by nestcheck</span>
<span class="w">    </span>-<span class="w"> </span>astropy<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">5</span>.2,<span class="w"> </span>&lt;<span class="w"> </span><span class="m">7</span>.0.0<span class="w">   </span><span class="c1"># reading FITS files</span>
<span class="w">    </span>-<span class="w"> </span>emcee<span class="w">                     </span><span class="c1"># MCMC sammpler</span>
</pre></div>
</div>
<p>The core packages required for likelihood functionality are
<a class="reference external" href="https://docs.scipy.org/doc/numpy/index.html">numpy</a>,
<a class="reference external" href="http://cython.readthedocs.io/en/latest">cython</a>,
<a class="reference external" href="https://matplotlib.org/stable/index.html">matplotlib</a>,
<a class="reference external" href="https://docs.scipy.org/doc//scipy/index.html">scipy</a>, and
<a class="reference external" href="https://wrapt.readthedocs.io/en/latest/">wrapt</a>.</p>
<p>To create a virtual environment from this file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>&lt;path/to/xpsi&gt;/environment.yml
</pre></div>
</div>
<p>If conda does not solve the environment dependencies, you may need to create
an environment manually via</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>xpsi
</pre></div>
</div>
<p>and then install the core dependencies listed in <code class="docutils literal notranslate"><span class="pre">basic_environment.yml</span></code> via
conda.</p>
<p>Activate the environment as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>activate<span class="w"> </span>xpsi
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>ALL THE FOLLOWING STEPS SHOULD BE PERFORMED IN THIS NEWLY CREATED
ENVIRONMENT.</strong> Pay special attention to reactivate the environment if you
ever have to restart the kernel.</p>
</div>
<p>We now install
<a class="reference external" href="https://bitbucket.org/mpi4py/mpi4py/downloads/">mpi4py</a> which is required for
nested sampling:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>mpi4py
</pre></div>
</div>
<p>We also need <a class="reference external" href="https://github.com/JohannesBuchner/PyMultiNest">PyMultiNest</a>
(the interface to the MultiNest library) for nested sampling.
However, <cite>conda install -c conda-forge pymultinest</cite> might try
to install dependencies in the environment,
including binaries for MPI, BLAS/LAPACK, and a Fortran compiler,
all in order to install MultiNest. Moreover, the MultiNest version
listed is a minor release too low to satisfy all our needs.
Thus, see the PyMultiNest instructions below.</p>
<p>Then, install optional packages
<a class="reference external" href="https://getdist.readthedocs.io/en/latest/">getdist</a>,
<a class="reference external" href="https://docs.h5py.org/en/stable/index.html">h5py</a>,
<a class="reference external" href="https://nestcheck.readthedocs.io/en/latest/">nestcheck</a>, and
<a class="reference external" href="https://fgivenx.readthedocs.io/en/latest/">fgivenx</a> which are required for
post-processing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>getdist<span class="w"> </span>h5py<span class="w"> </span>nestcheck<span class="w"> </span>fgivenx
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>However, to get the most updated versions of getdist and nestcheck (which may be needed by
some of the X-PSI post-processing features), they should be installed from the source
(<a class="reference external" href="https://github.com/cmbant/getdist">https://github.com/cmbant/getdist</a> and <a class="reference external" href="https://github.com/ejhigson/nestcheck">https://github.com/ejhigson/nestcheck</a>)
by cloning the repositories and running <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></code> in them.</p>
</div>
<p>In addition, some optional miscellaneous packages are:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://jupyter-notebook.readthedocs.io/en/stable/">jupyter</a> if you want to run X-PSI in a notebook. You may also need the <code class="docutils literal notranslate"><span class="pre">ipywidgets</span></code> that can be installed with <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">ipywidgets</span></code>.</p></li>
<li><p><a class="reference external" href="https://docs.pytest.org/en/7.2.x/">pytest</a> if you want to run functionality tests for X-PSI.</p></li>
<li><p><a class="reference external" href="https://emcee.readthedocs.io/en/latest/">emcee</a> for optional ensemble-MCMC functionality.</p></li>
<li><p><a class="reference external" href="https://johannesbuchner.github.io/UltraNest/readme.html">UltraNest</a> as alternative sampler.</p></li>
<li><p><a class="reference external" href="https://sbi-dev.github.io/sbi/latest/">sbi</a> for performing Simulation-Based Inference (SBI). This additionally requires installation of <a class="reference external" href="https://pytorch.org/get-started/locally/">torch and torchvision</a>.</p></li>
</ol>
</section>
</section>
<section id="prerequisite-non-python-packages-and-pymultinest">
<span id="nonpython"></span><h2>Prerequisite Non-Python Packages and PyMultiNest<a class="headerlink" href="#prerequisite-non-python-packages-and-pymultinest" title="Link to this heading"></a></h2>
<p>X-PSI has dependencies that are not Python packages,
or which are Python packages but need to be installed from source (PyMultiNest).
Build and install guidelines are given below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The next steps require an <a class="reference external" href="http://www.openmp.org">OpenMP</a>-enabled C
compiler (known compatibility with <code class="docutils literal notranslate"><span class="pre">icc</span></code>, <code class="docutils literal notranslate"><span class="pre">gcc</span></code>, and <code class="docutils literal notranslate"><span class="pre">clang</span></code>). Most
linux systems come with <a class="reference external" href="https://gcc.gnu.org">GCC</a> built-in. To find out
the GCC path-executable on your system, run <code class="docutils literal notranslate"><span class="pre">which</span> <span class="pre">gcc</span></code>.</p>
</div>
<section id="multinest">
<span id="id1"></span><h3>MultiNest<a class="headerlink" href="#multinest" title="Link to this heading"></a></h3>
<p>Although production sampling runs need to be performed on a high-performance
system and X-PSI can be installed locally without sampling functionality, it is
advisable to install MultiNest on your personal machine to gain experience in
application to inexpensive test problems. In addition, to leverage some
capabilities of sample post-processing software you
<a class="reference external" href="https://github.com/farhanferoz/MultiNest">require MultiNest</a> <code class="docutils literal notranslate"><span class="pre">v3.12</span></code>.
To build the MultiNest library, you require an MPI-wrapped Fortran compiler
(e.g.,  <a class="reference external" href="https://anaconda.org/conda-forge/openmpi-mpifort">openmpi-mpifort</a>
from Open MPI).</p>
<p>Prerequisites for MultiNest are c and fortran
compilers (e.g. <code class="docutils literal notranslate"><span class="pre">gcc</span></code> and <code class="docutils literal notranslate"><span class="pre">gfortran</span></code>), <code class="docutils literal notranslate"><span class="pre">cmake</span></code>, <code class="docutils literal notranslate"><span class="pre">blas</span></code>, <code class="docutils literal notranslate"><span class="pre">lapack</span></code>, and
<code class="docutils literal notranslate"><span class="pre">atlas</span></code>. In case missing them, they can be installed by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>cmake<span class="w"> </span>libblas-dev<span class="w"> </span>liblapack-dev<span class="w"> </span>libatlas-base-dev
</pre></div>
</div>
<p>To have MPI-wrapped compilers, one should also install <code class="docutils literal notranslate"><span class="pre">mpich</span></code> if not installed already:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>mpich
</pre></div>
</div>
<p>Assuming these libraries are available, first clone the repository,
then navigate to it and build:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/farhanferoz/MultiNest.git<span class="w"> </span>&lt;path/to/clone&gt;/multinest
<span class="nb">cd</span><span class="w"> </span>&lt;path/to/clone&gt;/multinest/MultiNest_v3.12_CMake/multinest/
mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
<span class="nv">CC</span><span class="o">=</span>gcc<span class="w"> </span><span class="nv">FC</span><span class="o">=</span>&lt;path/to/working/mpifortran/compiler/&gt;mpif90<span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>g++<span class="w"> </span>cmake<span class="w"> </span>-DCMAKE_<span class="o">{</span>C,CXX<span class="o">}</span><span class="nv">_FLAGS</span><span class="o">=</span><span class="s2">&quot;-O3 -march=native -funroll-loops&quot;</span><span class="w"> </span>-DCMAKE_Fortran_FLAGS<span class="o">=</span><span class="s2">&quot;-O3 -march=native -funroll-loops&quot;</span><span class="w"> </span>..
make
ls<span class="w"> </span>../lib/
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We note that new default mpif90 created by mpi4py conda installation may not work here. Thus, one needs to point the path to the native mpif90 compiler of the system (e.g. <code class="docutils literal notranslate"><span class="pre">CC=gcc</span> <span class="pre">FC=/usr/bin/mpif90</span> <span class="pre">CXX=g++</span> <span class="pre">...</span></code>) or install mpi4py only after MultiNest has been installed and use then <code class="docutils literal notranslate"><span class="pre">FC=mpif90</span></code>.</p>
</div>
<p>Now you need the Python interface to MultiNest:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/JohannesBuchner/PyMultiNest.git<span class="w"> </span>&lt;path/to/clone&gt;/pymultinest
<span class="nb">cd</span><span class="w"> </span>&lt;path/to/clone&gt;/pymultinest
python<span class="w"> </span>setup.py<span class="w"> </span>install<span class="w"> </span><span class="o">[</span>--user<span class="o">]</span>
</pre></div>
</div>
<p>The package will be installed in your conda environment, if the environment is activated.
In that case, the optional <code class="docutils literal notranslate"><span class="pre">--user</span></code> flag should be omitted.
We also need PyMultinest to interface with MultiNest. To do so, add the
following line to <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/my/directory/MultiNest/lib/:<span class="nv">$LD_LIBRARY_PATH</span>
</pre></div>
</div>
<p>It’s also good to check whether this has worked. In a new kernel, try</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import pymultinest&#39;</span>
</pre></div>
</div>
<p>which should import without any errors. If you get <code class="docutils literal notranslate"><span class="pre">ERROR:</span>&#160;&#160; <span class="pre">Could</span> <span class="pre">not</span> <span class="pre">load</span>
<span class="pre">MultiNest</span> <span class="pre">library</span> <span class="pre">&quot;libmultinest.so&quot;</span></code>, that means either MultiNest was not
successfully installed or could not be found.  While X-PSI will run properly,
the nested-sampling capabilities (requiring MultiNest) will crash. The user can
use emcee as the back-up sampler (see example in <a class="reference internal" href="Modeling.html"><span class="doc">Modeling</span></a>).
Note however that the post-processing tutorials have only been implemented
for the outputs of MultiNest.</p>
</section>
</section>
<section id="x-psi">
<h2>X-PSI<a class="headerlink" href="#x-psi" title="Link to this heading"></a></h2>
<p>Finally, to build and install from the X-PSI clone root, execute:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>&lt;path/to/compiler/executable&gt;<span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>install<span class="w"> </span><span class="o">[</span>--user<span class="o">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--user</span></code> flag is optional and specifies where the package is installed;
if you want to install the package in a virtual environment (as recommended), omit this flag.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">icc</span></code>, you may need to prepend this command with
<code class="docutils literal notranslate"><span class="pre">LDSHARED=&quot;icc</span> <span class="pre">-shared&quot;</span></code>. This ensures that both the compiler and linker
are Intel, otherwise the <code class="docutils literal notranslate"><span class="pre">gcc</span></code> linker might be invoked.</p>
<p>A quick check of the X-PSI installation can be done with <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">xpsi</span></code>, which
should print to screen something like the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/<span class="o">=============================================</span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>X-PSI:<span class="w"> </span>X-ray<span class="w"> </span>Pulse<span class="w"> </span>Simulation<span class="w"> </span>and<span class="w"> </span>Inference<span class="w"> </span><span class="p">|</span>
<span class="p">|</span>---------------------------------------------<span class="p">|</span>
<span class="p">|</span><span class="w">                </span>Version:<span class="w"> </span><span class="m">3</span>.0.6<span class="w">               </span><span class="p">|</span>
<span class="p">|</span>---------------------------------------------<span class="p">|</span>
<span class="p">|</span><span class="w">      </span>https://xpsi-group.github.io/xpsi<span class="w">      </span><span class="p">|</span>
<span class="se">\=</span><span class="o">============================================</span>/

Imported<span class="w"> </span>emcee<span class="w"> </span>version:<span class="w"> </span><span class="m">3</span>.1.6
Warning:<span class="w"> </span>Cannot<span class="w"> </span>import<span class="w"> </span>torch<span class="w"> </span>and<span class="w"> </span><span class="nb">test</span><span class="w"> </span>SBI_wrapper.
Imported<span class="w"> </span>GetDist<span class="w"> </span>version:<span class="w"> </span><span class="m">1</span>.6.4
Imported<span class="w"> </span>nestcheck<span class="w"> </span>version:<span class="w"> </span><span class="m">0</span>.2.1
</pre></div>
</div>
<p>Some warnings may appear if you are missing Multinest/Ultranest packages.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Importing X-PSI should not be done in the X-PSI root directory (where the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file locates).
Otherwise, a following type of error is expected:
<code class="docutils literal notranslate"><span class="pre">ImportError:</span> <span class="pre">cannot</span> <span class="pre">import</span> <span class="pre">name</span> <span class="pre">'set_phase_interpolant'</span> <span class="pre">from</span> <span class="pre">'xpsi.tools'</span> <span class="pre">(unknown</span> <span class="pre">location)</span></code></p>
</div>
<p>For a more complete verification of the X-PSI installation, you can execute
the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>examples/examples_fast/Modules/
python<span class="w"> </span>main.py
</pre></div>
</div>
<p>This module performs a <code class="docutils literal notranslate"><span class="pre">likelihood</span> <span class="pre">check</span></code>. If the likelihood value calculated
matches the given value, X-PSI is functioning as expected, else it will raise
an error message.  The following part of this module requires a functioning
MultiNest installation. It initiates sampling using MultiNest, and given the
settings, it should take ~5 minutes. To cancel mid-way press <code class="docutils literal notranslate"><span class="pre">ctrl</span> <span class="pre">+</span> <span class="pre">C</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that in X-PSI versions before 2.1.0 the selection of the atmosphere
extension needed to be done when installing X-PSI using appropriate flags:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>&lt;path/to/compiler/executable&gt;<span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>--help
<span class="nv">CC</span><span class="o">=</span>&lt;path/to/compiler/executable&gt;<span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>install<span class="w"> </span><span class="o">[</span>--NumHot<span class="o">]</span><span class="w"> </span><span class="o">[</span>--NumElse<span class="o">]</span><span class="w"> </span><span class="o">[</span>--user<span class="o">]</span>
</pre></div>
</div>
<p>This installed the numerical atmosphere for the hot regions and/or for
the rest of the surface (<code class="docutils literal notranslate"><span class="pre">elsewhere</span></code>). To (re-) install the default
blackbody surface emission model, the following command without the flags
was used:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>&lt;path/to/compiler/executable&gt;<span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>install<span class="w"> </span><span class="o">[</span>--user<span class="o">]</span>
</pre></div>
</div>
<p>For X-PSI versions newer than 2.1.0 atmosphere selection is done without
reinstalling X-PSI.</p>
</div>
<p>If you ever need to reinstall, first clean to recompile the C files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>-r<span class="w"> </span>build<span class="w"> </span>dist<span class="w"> </span>*egg*<span class="w"> </span>xpsi/*/*.c
</pre></div>
</div>
<p>Alternatively, to build X-PSI in-place:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>&lt;path/to/compiler/executable&gt;<span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>build_ext<span class="w"> </span>-i
</pre></div>
</div>
<p>This will build extension modules in the source code directory. You must in
this case ensure that the source code directory is on your <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>
environment variable, or inserted into <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> within a calling module.</p>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading"></a></h2>
<p>If you wish to compile the documentation you require
<a class="reference external" href="http://www.sphinx-doc.org/en/master">Sphinx</a> and extensions. To install
these, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;sphinx&lt;7.0&quot;</span>
conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>nbsphinx
conda<span class="w"> </span>install<span class="w"> </span>decorator
conda<span class="w"> </span>install<span class="w"> </span>sphinxcontrib-websupport
conda<span class="w"> </span>install<span class="w"> </span>sphinx_rtd_theme
</pre></div>
</div>
<p>Now the documentation can be compiled using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>xpsi/docs<span class="p">;</span><span class="w"> </span><span class="o">[</span>make<span class="w"> </span>clean<span class="p">;</span><span class="o">]</span><span class="w"> </span>make<span class="w"> </span>html
</pre></div>
</div>
<p>To rebuild the documentation after a change to source code docstrings:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span><span class="nv">CC</span><span class="o">=</span>&lt;path/to/compiler/executable&gt;<span class="o">]</span><span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>install<span class="w"> </span><span class="o">[</span>--user<span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="nb">cd</span>
docs<span class="p">;</span><span class="w"> </span>make<span class="w"> </span>clean<span class="p">;</span><span class="w"> </span>make<span class="w"> </span>html<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.html</span></code> files can then be found in <code class="docutils literal notranslate"><span class="pre">xpsi/docs/build/html</span></code>, along with the
notebooks for the tutorials in this documentation. The <code class="docutils literal notranslate"><span class="pre">.html</span></code> files can
naturally be opened in a browser, handily via a Jupyter session (this is
particularly useful if the edits are to tutorial notebooks).</p>
<p>Note that if you require links to the source code in the HTML files, you need
to ensure Sphinx imports the <code class="docutils literal notranslate"><span class="pre">xpsi</span></code> package from the source directory
instead of from the <code class="docutils literal notranslate"><span class="pre">~/.local/lib</span></code> directory of the user. To enforce this,
insert the path to the source directory into <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> in the <code class="docutils literal notranslate"><span class="pre">conf.py</span></code>
script. Then make sure the extension modules are inside the source directory
– i.e., the package is built in-place (see above).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To build the documentation, all modules need to be imported, and the
dependencies that are not resolved will print warning messages.</p>
</div>
</section>
<section id="tips-for-installing-on-mac-os">
<h2>Tips for installing on Mac OS<a class="headerlink" href="#tips-for-installing-on-mac-os" title="Link to this heading"></a></h2>
<p>Most of the aforementioned instructions for linux are also applicable for Mac
OS. Here we note some of the changes required.</p>
<p>After creating the environment using the <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> file,
install <code class="docutils literal notranslate"><span class="pre">xcode</span></code> or <code class="docutils literal notranslate"><span class="pre">xcode</span> <span class="pre">tools</span></code>. Be mindful of the sequence of programs to
be installed hereafter. Use <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> to download and install <code class="docutils literal notranslate"><span class="pre">h5py</span></code>
and <code class="docutils literal notranslate"><span class="pre">emcee</span></code> (and <code class="docutils literal notranslate"><span class="pre">maplotlib</span></code>, <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, <code class="docutils literal notranslate"><span class="pre">scipy</span></code> and <code class="docutils literal notranslate"><span class="pre">cython</span> <span class="pre">~=</span> <span class="pre">3.0.11</span></code>
if not using the <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>. You may use the file as a reference of the
packages required).</p>
<p>On Mac OS, it’s preferable to use <code class="docutils literal notranslate"><span class="pre">llvm</span> <span class="pre">clang</span></code> rather than <code class="docutils literal notranslate"><span class="pre">gcc</span></code>.  The
<code class="docutils literal notranslate"><span class="pre">homebrew</span></code> version of <code class="docutils literal notranslate"><span class="pre">clang</span></code> works, but some users may face potential
issues (see below for the MacOS native <code class="docutils literal notranslate"><span class="pre">clang</span></code>).  To use <code class="docutils literal notranslate"><span class="pre">homebrew</span></code> version
of <code class="docutils literal notranslate"><span class="pre">clang</span></code>, first install  <code class="docutils literal notranslate"><span class="pre">homebrew</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/usr/bin/ruby<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://raw.githubusercontent.com/Homebrew/install/master/install<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Install <code class="docutils literal notranslate"><span class="pre">llvm</span></code> with homebrew, even if weird messages appear, saying llvm is
already present in the Mac OS:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>brew<span class="w"> </span>install<span class="w"> </span>llvm
</pre></div>
</div>
<p>Install <code class="docutils literal notranslate"><span class="pre">GSL</span></code> (see above).</p>
<p>Install <code class="docutils literal notranslate"><span class="pre">fortran</span></code> before <code class="docutils literal notranslate"><span class="pre">MPI</span></code>. If faced with issues when specifying or
using gfortran (and it “does not pass simple tests”) specify the compiler as
being gfortran in the <code class="docutils literal notranslate"><span class="pre">mpif90</span></code> wrapper files and delete the files that were
already in the build directory. Once <code class="docutils literal notranslate"><span class="pre">MPI</span></code> is installed, export the following
environment variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;/Users/&lt;your_path&gt;/openmpi/lib:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/Users/&lt;your_path&gt;/mpi/bin/
<span class="nb">export</span><span class="w"> </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">&quot;-L/usr/local/opt/llvm/lib&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">&quot;-I/usr/local/opt/llvm/include&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">KMP_DUPLICATE_LIB_OK</span><span class="o">=</span>TRUE
</pre></div>
</div>
<p>Consider adding these lines directly in your bashrc (or equivalent file for a
different shell e.g. zshrc).</p>
<p>Install <code class="docutils literal notranslate"><span class="pre">X-PSI</span></code> using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>/usr/local/opt/llvm/bin/clang<span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>install<span class="w"> </span><span class="o">[</span>--user<span class="o">]</span>
</pre></div>
</div>
<p>If you are facing problems with this installation (e.g., linker problems, or
–fopenmp libraries missing), you may try the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>/usr/local/opt/llvm/bin/clang<span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>install<span class="w"> </span>--noopenmp<span class="w"> </span><span class="o">[</span>--user<span class="o">]</span>
</pre></div>
</div>
<p>You may also try to use the MacOS native version of <code class="docutils literal notranslate"><span class="pre">clang</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span><span class="o">=</span>/usr/bin/clang<span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>install<span class="w"> </span>--noopenmp<span class="w"> </span><span class="o">[</span>--user<span class="o">]</span>
</pre></div>
</div>
<p>If you encounter any problems with permissions when installing X-PSI, use the
<code class="docutils literal notranslate"><span class="pre">--user</span></code> option (This will install X-PSI globally, and not just within your
virtual environment).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We are encountering issues with installing MultiNest on Mac and we are working on proposing a solution.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the <a class="reference internal" href="FAQ.html#faq"><span class="std std-ref">FAQs and common problems</span></a> page for issues that might arise if you are trying to install on Mac using a non-native <code class="docutils literal notranslate"><span class="pre">gcc</span></code> compiler.</p>
</div>
</section>
<section id="tips-for-installing-on-windows">
<h2>Tips for installing on Windows<a class="headerlink" href="#tips-for-installing-on-windows" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We do not recommend installing and running X-PSI on windows. However, if
you must, this section details some of the relevant procedures.</p>
</div>
<p>X-PSI was successfully installed and run on Windows in the year 2020, at least
for the purpose of likelihood functionality, using the following
user-contributed procedure.</p>
<ul class="simple">
<li><p>Clone the X-PSI repository to a directory on your Windows computer (see above).</p></li>
<li><p>Download <a class="reference external" href="https://www.windowscentral.com/install-windows-subsystem-linux-windows-10">Ubuntu</a> for Windows.</p></li>
<li><p>Install a Anaconda or Miniconda  virtual Python environment in an Ubuntu shell.</p></li>
<li><p>Follow the instructions of this page to install all the python and non-python packages.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="X-ray Pulse Simulation and Inference (X-PSI)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="overview.html" class="btn btn-neutral float-right" title="Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2026 the X-PSI Core Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>