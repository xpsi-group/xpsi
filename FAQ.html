

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FAQs and common problems &mdash; x-psi 3.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=796a81b5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Publications" href="applications.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            x-psi
              <img src="_static/xpsilogo_small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">FAQs and common problems</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sampling">Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-problems-and-errors">Common problems and errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#weird-issues">Weird issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="applications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="HPC_systems.html">HPC systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">Future</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Team and acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Start_here.html">Start here</a></li>
<li class="toctree-l1"><a class="reference internal" href="XPSI_101.html">X-PSI 101 - For Beginners</a></li>
<li class="toctree-l1"><a class="reference internal" href="Modeling.html">Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Instrument_synergy.html">Instrument synergy</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hot_region_complexity.html">Hot region complexity</a></li>
<li class="toctree-l1"><a class="reference internal" href="Global_surface_emission.html">Global surface emission</a></li>
<li class="toctree-l1"><a class="reference internal" href="Surface_radiation_field_tools.html">Surface radiation field tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Modeling_without_statistics.html">Modeling (without statistics)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Polarization.html">Polarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Post-processing.html">Post-processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Emitting_patterns_2Dprojection.html">Emitting Patterns 2D Projection</a></li>
<li class="toctree-l1"><a class="reference internal" href="Accretion_disk.html">Accretion disk</a></li>
<li class="toctree-l1"><a class="reference internal" href="Multiple_imaging.html">Multiple imaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Importance_sampling.html">Importance Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Module_generator_tutorial.html">Module generator tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example_script_and_modules.html">Example script and modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example_job.html">Example job</a></li>
<li class="toctree-l1"><a class="reference internal" href="x_p_sbi.html">Posterior Inference using SBI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="likelihood_api.html">Likelihood API</a></li>
<li class="toctree-l1"><a class="reference internal" href="extension_modules.html">Extension modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="posterior_api.html">Posterior API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">x-psi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">FAQs and common problems</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/FAQ.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="faqs-and-common-problems">
<span id="faq"></span><h1>FAQs and common problems<a class="headerlink" href="#faqs-and-common-problems" title="Link to this heading"></a></h1>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h2>
<p class="rubric">Do I need to edit the package setup script?</p>
<p>You may well have to edit the setup script depending on the target system.
This includes editing compiler flags (see below for example regarding
instruction sets).</p>
<p class="rubric">Does it matter what compiler I use?</p>
<p>The Intel compiler collection has been used successfully for X-PSI and
dependencies (namely GSL, MultiNest). We recommend first trying to use Intel
in a context where performance matters.</p>
<p class="rubric">What Intel instruction sets should I use?</p>
<p>If you want to test the binaries on a login node, note that you can
compile with multiple instruction sets for auto-dispatch using the <code class="docutils literal notranslate"><span class="pre">-x</span></code> and
<code class="docutils literal notranslate"><span class="pre">-ax</span></code> flags. See the <a class="reference internal" href="HPC_systems.html#hpcsystems"><span class="std std-ref">HPC systems</span></a> page for examples.</p>
</section>
<section id="sampling">
<h2>Sampling<a class="headerlink" href="#sampling" title="Link to this heading"></a></h2>
<p class="rubric">Is I/O or disk storage a concern, or are all the files small?</p>
<p>I/O not a concern for likelihood calculation.</p>
<p>Nested sampling writes to disk at user-specified cadence
(so many nested sampling iterations).</p>
<p>Model data such as a four-dimensional atmosphere table can be reasonably
large for I/O.
We recommend loading, at the outset of the run (or a resumed run),
such a table into a contiguous chunk of memory
for each of the Python processes running on one node.
That table is pointed to for access where needed from compiled modules
(C extensions to Python): it is not loaded from disk per likelihood call.
We provide an example custom Python class that handles this loading (as used
in <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2019ApJ...887L..21R/abstract">Riley et al. 2019</a>, hereafter R19).</p>
<p>Disk storage required is indeed small: up to <span class="math notranslate nohighlight">\(\mathcal{O}(100)\)</span> Mbytes for
applications thus far (e.g., R19). There is a variant of MultiNest nested sampling
that is much more memory and disk intensive, but we do not use it.  This is
because importance nested sampling is not compatible with the alternative options
(read: hacks) for prior implementation (see <a class="reference external" href="https://hdl.handle.net/11245.1/aa86fcf3-2437-4bc2-810e-cf9f30a98f7a">Riley, PhD thesis</a>).</p>
</section>
<section id="common-problems-and-errors">
<h2>Common problems and errors<a class="headerlink" href="#common-problems-and-errors" title="Link to this heading"></a></h2>
<p class="rubric">How to avoid errors in post-processing?</p>
<p>Do not use X-PSI PostProcessing tools for runs which have not converged yet or have not enough samples. Also, when post-processing, make sure to check the data and output file paths, use <code class="docutils literal notranslate"><span class="pre">cache=True</span></code> if plotting the signal, and perform a likelihood check to be sure that the imported model is the same as in the run.</p>
<p class="rubric"><em>AttributeError: ’NestedBackend’ object has no attribute ’:math:`_nc_bcknd`’</em></p>
<p>Can happen in PostProcessing for runs with <code class="docutils literal notranslate"><span class="pre">use_nestcheck=[False]</span></code> (e.g. importance sampling). Solution is to turn <code class="docutils literal notranslate"><span class="pre">bootstrap_estimators=False</span></code>, or alternatively, set <code class="docutils literal notranslate"><span class="pre">use_nestcheck=[True]</span></code>.</p>
<p class="rubric">Why does my skymap show many annular images like this:</p>
<div class="figure docutils container">
<a class="reference internal image-reference" href="_images/ST_PST__NICER__skymap_phase_averaged_run1.png"><img alt="image" src="_images/ST_PST__NICER__skymap_phase_averaged_run1.png" style="width: 10cm;" />
</a>
</div>
<p>The problem is the <code class="docutils literal notranslate"><span class="pre">xpsi/xpsi/surface_radiation_field/local_variables.pyx</span></code> file which should be overwritten by <code class="docutils literal notranslate"><span class="pre">xpsi/xpsi/surface_radiation_field/archive/local_variables/PST_U.pyx</span></code> or <code class="docutils literal notranslate"><span class="pre">xpsi/xpsi/surface_radiation_field/archive/local_variables/two_spots.pyx</span></code> (depending on the model) and then re-install X-PSI.</p>
<p class="rubric"><em>ImportError: No module named tools</em></p>
<p>You are running X-PSI from its main directory (the directory where the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file is). Exit that directory and run it again.</p>
<p class="rubric"><em>&lt;path/to/run/output&gt;dead-birth.txt not found.</em></p>
<p>Set <code class="docutils literal notranslate"><span class="pre">use_nestcheck=[False]</span></code> or check that nestcheck is installed exactly as instructed in <a class="reference internal" href="install.html#install"><span class="std std-ref">Installation</span></a> (by cloning it from <code class="docutils literal notranslate"><span class="pre">https://github.com/ThomasEdwardRiley/nestcheck.git</span></code>).</p>
<p class="rubric"><em>Invalid caching targets.</em></p>
<p>Set <code class="docutils literal notranslate"><span class="pre">cache=True</span></code> for the signal.</p>
<p class="rubric"><em>Each row and column must contain at least one positive number.</em></p>
<p>There are some rows and/or column in the instrument response that contain only zeros. Solution is to increase the number of channels or decrease the number of energy intervals.</p>
<p class="rubric"><em>Warning: Using native nestcheck KDE instead of GetDist KDE.</em></p>
<p>Make sure to to install nestcheck and GetDist packages using the corresponding github repositories as instructed in <a class="reference internal" href="install.html#install"><span class="std std-ref">Installation</span></a>.</p>
<p class="rubric"><em>ValueError: There is more than one signal instance.</em></p>
<p>Typically occurs when post-processing joint NICER and XMM results, if not setting <code class="docutils literal notranslate"><span class="pre">model.likelihood.signals</span> <span class="pre">=</span> <span class="pre">model.likelihood.signals[0][0]</span></code> (when plotting the inferred NICER signal).</p>
</section>
<section id="weird-issues">
<h2>Weird issues<a class="headerlink" href="#weird-issues" title="Link to this heading"></a></h2>
<p class="rubric"><em>The import order of pymultinest and numpy may sometimes affect the seed-fixed results.</em></p>
<p>The import order of numpy and X-PSI (and thus pymultinest) was observed to sometimes influence the exact sampling results even if fixing the random seeds for both numpy and pymultinest. However, the issue occurred only in specific conda environments (with certain packages/dependencies) and later attempts to reproduce it with newer X-PSI installations have not been successful. See the <a class="reference external" href="https://github.com/xpsi-group/xpsi/issues/276">GitHub issue</a> for more details.</p>
<p class="rubric"><em>Linker library name format in setup.py may cause issues with install under rare circumstances.</em></p>
<p><code class="docutils literal notranslate"><span class="pre">setup.py</span></code> has the following if-else block (twice):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="s1">&#39;clang&#39;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>os.environ<span class="o">[</span><span class="s1">&#39;CC&#39;</span><span class="o">]</span>:
<span class="w">    </span><span class="nv">libraries</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;inversion.so&#39;</span>,<span class="w"> </span><span class="s1">&#39;deflection.so&#39;</span><span class="o">]</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">libraries</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;:inversion.so&#39;</span>,<span class="w"> </span><span class="s1">&#39;:deflection.so&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">:</span></code> indicates to the GNU linker that the library name should be taken as is, that is, not prepended with <code class="docutils literal notranslate"><span class="pre">lib</span></code>. <a class="footnote-reference brackets" href="#f1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>
The linker on Darwin (macOS), probably a BSD(-derived) linker, takes any(?) name that has a extension as the literal name, and won’t search for <code class="docutils literal notranslate"><span class="pre">lib&lt;name&gt;.dylib</span></code> or <code class="docutils literal notranslate"><span class="pre">lib&lt;name&gt;a</span></code>. <a class="footnote-reference brackets" href="#f2" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> So that linker does this automagically, whereas the GNU linker wants to be explicit.</p>
<p>Note the use of linker in the above paragraph: it is not the compiler that makes the difference, but the linker. On the command line, it will look like the compiler (the linking step still shows the compiler being used), but under the hood it calls the linker, <code class="docutils literal notranslate"><span class="pre">ld</span></code>. Therefore, the linker should be the differentiating factor which of the two if-branches is used, not the compiler (or its environment variable, <code class="docutils literal notranslate"><span class="pre">CC</span></code>).</p>
<p>This issue pops when building X-PSI on macOS with <code class="docutils literal notranslate"><span class="pre">gcc</span></code> (note: not the built-in <code class="docutils literal notranslate"><span class="pre">gcc</span></code>, which is clang in disguise: check <code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">--version</span></code>; but for example <code class="docutils literal notranslate"><span class="pre">gcc</span></code> installed with Homebrew), or when using <code class="docutils literal notranslate"><span class="pre">clang</span></code> on Linux. Both builds will error at this point when linking with the so-files is done.</p>
<p>A manual, <em>local</em>, quick fix is just to insert or remove the colons in front of the library names in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>, and the build can continue. But this is only a local solution, and can’t be implemented in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> by default.</p>
<p>The linker, however, is trickier to determine than the compiler. But the linker is also tied into the system ecosystem (through system libraries); for example, the GNU linker is not supported on Darwin (though perhaps a BSD linker can be installed on a Linux system).
Instead, one could try and determine the system OS and use that, instead of the compiler, in the if-statement: <code class="docutils literal notranslate"><span class="pre">sys.platform</span></code> may be of use here.</p>
<p>Note that the use cases will be rare: the default compiler on macOS tends to be <code class="docutils literal notranslate"><span class="pre">clang</span></code> (installed as part of the XCode tools), and even the default <code class="docutils literal notranslate"><span class="pre">gcc</span></code> is just <code class="docutils literal notranslate"><span class="pre">clang</span></code> in disguise. On Linux, the majority of times the default compiler is <code class="docutils literal notranslate"><span class="pre">gcc</span></code>. I don’t know which linker the Intel compiler will use; perhaps the GNU linker, perhaps it has its own linker (but given that the OS is formally GNU/Linux, I suspect the linker is the GNU one). Most people are not likely to deviate from this, so the check for <code class="docutils literal notranslate"><span class="pre">clang</span></code> tends to nearly always be True for macOS and False for Linux.</p>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f1" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>from the GNU ld manpage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-l<span class="w"> </span>namespec
--library<span class="o">=</span>namespec
Add<span class="w"> </span>the<span class="w"> </span>archive<span class="w"> </span>or<span class="w"> </span>object<span class="w"> </span>file<span class="w"> </span>specified<span class="w"> </span>by<span class="w"> </span>namespec<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>files<span class="w"> </span>to<span class="w"> </span>link.
This<span class="w">    </span>option<span class="w"> </span>may<span class="w"> </span>be<span class="w"> </span>used<span class="w"> </span>any<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span>times.<span class="w"> </span>If<span class="w"> </span>namespec<span class="w"> </span>is<span class="w"> </span>of<span class="w"> </span>the
form<span class="w"> </span>:filename,<span class="w"> </span>ld<span class="w"> </span>will<span class="w"> </span>search<span class="w"> </span>the<span class="w"> </span>library<span class="w"> </span>path<span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>file<span class="w"> </span>called<span class="w"> </span>filename,
otherwise<span class="w"> </span>it<span class="w"> </span>will<span class="w"> </span>search<span class="w"> </span>the<span class="w"> </span>library<span class="w"> </span>path<span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>file<span class="w"> </span>called<span class="w"> </span>libnamespec.a.
</pre></div>
</div>
</aside>
<aside class="footnote brackets" id="f2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>from the Darwin ld manpage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-lx<span class="w"> </span>This<span class="w"> </span>option<span class="w"> </span>tells<span class="w"> </span>the<span class="w"> </span>linker<span class="w"> </span>to<span class="w"> </span>search<span class="w"> </span><span class="k">for</span><span class="w"> </span>libx.dylib<span class="w"> </span>or<span class="w"> </span>libx.a<span class="w"> </span><span class="k">in</span><span class="w"> </span>the
library<span class="w"> </span>search<span class="w"> </span>path.<span class="w"> </span>If<span class="w"> </span>string<span class="w"> </span>x<span class="w"> </span>is<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>form<span class="w"> </span>y.o,<span class="w"> </span><span class="k">then</span><span class="w"> </span>that<span class="w"> </span>file<span class="w"> </span>is
searched<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span>places,<span class="w"> </span>but<span class="w"> </span>without<span class="w"> </span>prepending<span class="w"> </span>lib<span class="s1">&#39; or</span>
<span class="s1">appending .a&#39;</span><span class="w"> </span>or<span class="w"> </span><span class="sb">`</span>.dylib<span class="err">&#39;</span><span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>filename.
</pre></div>
</div>
</aside>
</aside>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="overview.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="applications.html" class="btn btn-neutral float-right" title="Publications" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2025 the X-PSI Core Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>