

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HPC systems &mdash; x-psi 3.2.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=eb155f5e"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Code of Conduct" href="code_of_conduct.html" />
    <link rel="prev" title="Publications" href="applications.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            x-psi
              <img src="_static/xpsilogo_small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQs and common problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications.html">Publications</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">HPC systems</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#snellius-surf">Snellius (SURF)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#batch-usage">Batch usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#helios-api">Helios (API)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Batch usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#calmip">CALMIP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">Installation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">Future</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Team and acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Start_here.html">Start here</a></li>
<li class="toctree-l1"><a class="reference internal" href="XPSI_101.html">X-PSI 101 - For Beginners</a></li>
<li class="toctree-l1"><a class="reference internal" href="Modeling.html">Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Instrument_synergy.html">Instrument synergy</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hot_region_complexity.html">Hot region complexity</a></li>
<li class="toctree-l1"><a class="reference internal" href="Global_surface_emission.html">Global surface emission</a></li>
<li class="toctree-l1"><a class="reference internal" href="Surface_radiation_field_tools.html">Surface radiation field tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Modeling_without_statistics.html">Modeling (without statistics)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Polarization.html">Polarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Post-processing.html">Post-processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Emitting_patterns_2Dprojection.html">Emitting Patterns 2D Projection</a></li>
<li class="toctree-l1"><a class="reference internal" href="Accretion_disk.html">Accretion disk</a></li>
<li class="toctree-l1"><a class="reference internal" href="Multiple_imaging.html">Multiple imaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Importance_sampling.html">Importance Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Module_generator_tutorial.html">Module generator tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example_script_and_modules.html">Example script and modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example_job.html">Example job</a></li>
<li class="toctree-l1"><a class="reference internal" href="x_p_sbi.html">Posterior Inference using SBI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="likelihood_api.html">Likelihood API</a></li>
<li class="toctree-l1"><a class="reference internal" href="extension_modules.html">Extension modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="posterior_api.html">Posterior API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">x-psi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">HPC systems</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/HPC_systems.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="hpc-systems">
<span id="hpcsystems"></span><h1>HPC systems<a class="headerlink" href="#hpc-systems" title="Link to this heading"></a></h1>
<p>The information provided in this page is for users who intend to work on
High-Performance Computing (HPC) systems. These installation instructions are
system-specific. X-PSI has already been used on different systems, for some of
which we provide the instructions below. This information may also be
translated to other systems by users looking for guidance.</p>
<section id="snellius-surf">
<h2>Snellius (SURF)<a class="headerlink" href="#snellius-surf" title="Link to this heading"></a></h2>
<p><a class="reference external" href="https://servicedesk.surf.nl/wiki/display/WIKI/Snellius">Snellius</a> is the
Dutch National Supercomputer.</p>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h3>
<p>All of the following must be performed on a login node, in your <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> file
system.</p>
<p>Start by cleaning your home file system of existing versions of dependencies
and move anything else to some archive in <code class="docutils literal notranslate"><span class="pre">$HOME</span></code>. Clean <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> and
<code class="docutils literal notranslate"><span class="pre">.bash_profile</span></code> of anything related to this software. Clean <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> and
<code class="docutils literal notranslate"><span class="pre">.bash_profile</span></code> of environment variables such as: <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code>,
<code class="docutils literal notranslate"><span class="pre">LD_PRELOAD</span></code>, <code class="docutils literal notranslate"><span class="pre">RUN_PATH</span></code>, <code class="docutils literal notranslate"><span class="pre">PATH</span></code>, and <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>. Then logout and
log back in order to get a clean environment.</p>
<p>To be additionally safe, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module<span class="w"> </span>purge
</pre></div>
</div>
<p>Load environment module and modify clean environment with foss toolchain
information and the needed modules:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module<span class="w"> </span>load<span class="w"> </span><span class="m">2024</span>
module<span class="w"> </span>load<span class="w"> </span>foss/2024a
module<span class="w"> </span>load<span class="w"> </span>SciPy-bundle/2024.05-gfbf-2024a
module<span class="w"> </span>load<span class="w"> </span>wrapt/1.16.0-gfbf-2024a
module<span class="w"> </span>load<span class="w"> </span>matplotlib/3.9.2-gfbf-2024a
module<span class="w"> </span>load<span class="w"> </span>CMake/3.29.3-GCCcore-13.3.0
module<span class="w"> </span>load<span class="w"> </span>Cython/3.0.10-GCCcore-13.3.0
</pre></div>
</div>
<p>Prepare a new Python virtual environment for X-PSI (named for example “xpsi_py3”) in case the possibility of having several co-existing X-PSI and/or PyMultiNest versions is wished (otherwise proceed to MultiNest installation):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>venvs
python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>./venvs/xpsi_py3
</pre></div>
</div>
<p>To access all the loaded site packages when activating the virtual environment, one needs to modify the file <code class="docutils literal notranslate"><span class="pre">./venvs/xpsi_py3/pyvenv.cfg</span></code> (using e.g. <code class="docutils literal notranslate"><span class="pre">vim</span></code> or <code class="docutils literal notranslate"><span class="pre">emacs</span></code> text editor) to change “false” into “true”:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Include<span class="w"> </span>system<span class="w"> </span>site<span class="w"> </span><span class="nv">packages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</pre></div>
</div>
<p>Now the environment can be activated with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>./venvs/xpsi_py3/bin/activate
</pre></div>
</div>
<p>Next, install mpi4py, h5py, and astropy:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>mpi4py
pip<span class="w"> </span>install<span class="w"> </span>h5py
pip<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;astropy&gt;=5.2,&lt;7.0.0&quot;</span>
</pre></div>
</div>
<p>To prepare <a class="reference external" href="https://github.com/farhanferoz/MultiNest">MultiNest</a> from
<code class="docutils literal notranslate"><span class="pre">$HOME</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/farhanferoz/MultiNest.git<span class="w"> </span>~/multinest
<span class="nb">cd</span><span class="w"> </span>~/multinest/MultiNest_v3.12_CMake/multinest
mkdir<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>-DCMAKE_<span class="o">{</span>C,CXX<span class="o">}</span><span class="nv">_FLAGS</span><span class="o">=</span><span class="s2">&quot;-O3 -march=znver2 -funroll-loops&quot;</span><span class="w"> </span>-DCMAKE_Fortran_FLAGS<span class="o">=</span><span class="s2">&quot;-O3 -march=znver2 -funroll-loops&quot;</span><span class="w"> </span>..<span class="p">;</span><span class="w"> </span>make
ls<span class="w"> </span>../lib/
</pre></div>
</div>
<p>Use the last command to check for the presence of shared objects.</p>
<p>We also need to set the environment variable for library path to point at
MultiNest:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:<span class="nv">$HOME</span>/multinest/MultiNest_v3.12_CMake/multinest/lib/
</pre></div>
</div>
<p>Now you need the Python interface to MultiNest, starting from <code class="docutils literal notranslate"><span class="pre">$HOME</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/JohannesBuchner/PyMultiNest.git<span class="w"> </span>~/pymultinest
<span class="nb">cd</span><span class="w"> </span>~/pymultinest
python<span class="w"> </span>setup.py<span class="w"> </span>install
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If not using a Python virtual environment, you should add <code class="docutils literal notranslate"><span class="pre">--user</span></code> flag when installing PyMultiNest.</p>
</div>
<p>To test the installation of MultiNest and PyMultiNest on the login node alongside with MPI:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpiexec<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>python<span class="w"> </span>pymultinest_demo.py
</pre></div>
</div>
<p>It is normal that it runs once, but prints parameter values and evidences twice!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We assumed above that nested sampling with <a class="reference external" href="https://github.com/farhanferoz/MultiNest">MultiNest</a> is desired. If
ensemble-MCMC with <code class="docutils literal notranslate"><span class="pre">emcee</span></code> is desired, you need to install the Python
packages <code class="docutils literal notranslate"><span class="pre">emcee</span></code> and <code class="docutils literal notranslate"><span class="pre">schwimmbad</span></code>. If <code class="docutils literal notranslate"><span class="pre">UltraNest</span></code> is desired, you
need to install the Python package <code class="docutils literal notranslate"><span class="pre">ultranest</span></code>. We assume the user
can infer how to do this using the information above and on the
<a class="reference internal" href="install.html#install"><span class="std std-ref">Installation</span></a> page.</p>
</div>
<p>For <a class="reference external" href="https://www.gnu.org/software/gsl/">GSL</a> we can use the default 2.5
version already provided in Snellius. Thus, to prepare X-PSI from <code class="docutils literal notranslate"><span class="pre">$HOME</span></code>, we
only need:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/xpsi-group/xpsi.git
<span class="nb">cd</span><span class="w"> </span>~/xpsi
<span class="nv">LDSHARED</span><span class="o">=</span><span class="s2">&quot;gcc -shared&quot;</span><span class="w"> </span><span class="nv">CC</span><span class="o">=</span>gcc<span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>install
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If not using a Python virtual environment, you should add <code class="docutils literal notranslate"><span class="pre">--user</span></code> flag when installing X-PSI.</p>
</div>
<p>If you ever need to reinstall, first clean to recompile C files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>-r<span class="w"> </span>build<span class="w"> </span>dist<span class="w"> </span>*egg*<span class="w"> </span>xpsi/*/*.c
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We typically do not use the <a class="reference internal" href="postprocessing.html#module-xpsi.PostProcessing" title="xpsi.PostProcessing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PostProcessing</span></code></a> module, but
instead <code class="docutils literal notranslate"><span class="pre">rsync</span></code> output files to a local system to perform plotting. This
circumvents any potential backend problems and permits straightforward use
of IPython for interactive plotting. However, if one wishes to use it on an
HPC, it would require the installation of <cite>GetDist</cite> and <cite>Nestcheck</cite>. See
<a class="reference internal" href="install.html#install"><span class="std std-ref">Installation</span></a> page for relevant details.</p>
</div>
</section>
<section id="batch-usage">
<h3>Batch usage<a class="headerlink" href="#batch-usage" title="Link to this heading"></a></h3>
<p>For an example job script, refer to <a class="reference internal" href="Example_job.html#example-job"><span class="std std-ref">Example job</span></a>.</p>
</section>
</section>
<section id="helios-api">
<h2>Helios (API)<a class="headerlink" href="#helios-api" title="Link to this heading"></a></h2>
<p>Helios is a cluster of the Anton Pannekoek Institute for Astronomy.</p>
<section id="id1">
<h3>Installation<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>Let’s start by loading the necessary modules and creating a Python environment. At the moment, the installation is known to be working for the specific python 3.11 version:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module<span class="w"> </span>purge
module<span class="w"> </span>load<span class="w"> </span>gnu12
module<span class="w"> </span>load<span class="w"> </span>openmpi4
module<span class="w"> </span>load<span class="w"> </span>gsl

python3.11<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span><span class="nv">$HOME</span>/venv311/xpsi
<span class="nb">source</span><span class="w"> </span><span class="nv">$HOME</span>/venv311/xpsi/bin/activate
</pre></div>
</div>
<p>Next, let’s pip installing the required python packages:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip<span class="w"> </span>setuptools<span class="w"> </span>wheel
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">numpy</span><span class="o">==</span><span class="m">1</span>.26.3
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">scipy</span><span class="o">==</span><span class="m">1</span>.13.0
pip<span class="w"> </span>install<span class="w"> </span>Cython<span class="w"> </span>matplotlib<span class="w"> </span>wrapt<span class="w"> </span>pymultinest<span class="w"> </span>getdist<span class="w"> </span>h5py<span class="w"> </span>pytest<span class="w"> </span>nestcheck<span class="w"> </span>mpi4py
</pre></div>
</div>
<p>Now, we make a seperate folder in which we build MultiNest:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span>
mkdir<span class="w"> </span>My_codes
<span class="nb">cd</span><span class="w"> </span>My_codes

git<span class="w"> </span>clone<span class="w"> </span>https://github.com/farhanferoz/MultiNest.git<span class="w"> </span>multinest
<span class="nb">cd</span><span class="w">  </span>multinest/MultiNest_v3.12_CMake/multinest
mkdir<span class="w"> </span>-p<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
<span class="nv">CC</span><span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>cc<span class="k">)</span><span class="w"> </span><span class="nv">FC</span><span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>mpif90<span class="k">)</span><span class="w"> </span><span class="nv">CXX</span><span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>c++<span class="k">)</span><span class="w"> </span>cmake<span class="w"> </span>-DCMAKE_<span class="o">{</span>C,CXX<span class="o">}</span><span class="nv">_FLAGS</span><span class="o">=</span><span class="s2">&quot;-O3 -march=native -funroll-loops&quot;</span><span class="w"> </span>-DCMAKE_Fortran_FLAGS<span class="o">=</span><span class="s2">&quot;-O3 -march=native -funroll-loops&quot;</span><span class="w"> </span>..
make
</pre></div>
</div>
<p>We then copy the MultiNest library files into our virtual environment and set-up the library path:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>../lib
cp<span class="w"> </span>*<span class="w"> </span><span class="nv">$VIRTUAL_ENV</span>/lib/.
cd<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$VIRTUAL_ENV</span>/lib/
cp<span class="w"> </span>/usr/lib64/liblapack.so.3<span class="w"> </span>.
cp<span class="w"> </span>/usr/lib64/libblas.so.3<span class="w"> </span>.
cp<span class="w"> </span>-r<span class="w"> </span>/usr/lib64/atlas<span class="w"> </span>.

<span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$VIRTUAL_ENV</span>/lib:<span class="nv">$LD_LIBRARY_PATH</span>
</pre></div>
</div>
<p>If the above works, we can then continue building X-PSI:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/My_codes
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/xpsi-group/xpsi.git
<span class="nb">cd</span><span class="w"> </span>xpsi
<span class="nv">CC</span><span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>cc<span class="k">)</span><span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>build
<span class="nv">CC</span><span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>cc<span class="k">)</span><span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>install
</pre></div>
</div>
</section>
<section id="id2">
<h3>Batch usage<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>For example job scripts, see the Helios example in <a class="reference internal" href="Example_job.html#example-job"><span class="std std-ref">Example job</span></a>.</p>
</section>
</section>
<section id="calmip">
<span id="calmipsystem"></span><h2>CALMIP<a class="headerlink" href="#calmip" title="Link to this heading"></a></h2>
<p><a class="reference external" href="https://www.calmip.univ-toulouse.fr">CALMIP</a> is the supercomputer of <a class="reference external" href="https://www.univ-toulouse.fr">Université Fédérale de Toulouse</a></p>
<section id="id4">
<h3>Installation<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>In your <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> file system, from the login node, start by loading the necessary modules:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module<span class="w"> </span>purge
module<span class="w"> </span>load<span class="w"> </span>conda
module<span class="w"> </span>load<span class="w"> </span>cmake
module<span class="w"> </span>load<span class="w"> </span>intel/19.5.041
module<span class="w"> </span>load<span class="w"> </span>intelmpi/19.5.041
module<span class="w"> </span>load<span class="w"> </span>gsl/2.5-icc
</pre></div>
</div>
<p>Then, create the conda environnnement and Install python packages with conda (or pip):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>xpsi<span class="w"> </span>--clone<span class="w"> </span>base
conda<span class="w"> </span>activate<span class="w"> </span>xpsi
conda<span class="w"> </span>install<span class="w"> </span>numpy<span class="w"> </span>scipy<span class="w"> </span>matplotlib<span class="w"> </span>wrapt<span class="w"> </span>astropy
pip<span class="w"> </span>install<span class="w"> </span>cython~<span class="o">=</span><span class="m">3</span>.0.11
conda<span class="w"> </span>install<span class="w"> </span>h5py
conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>fgivenx
pip<span class="w"> </span>install<span class="w"> </span>schwimmbad<span class="w"> </span>--user
</pre></div>
</div>
<p>Point to the Intel compilers</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">FC</span><span class="o">=</span>ifort
<span class="nb">export</span><span class="w"> </span><span class="nv">CC</span><span class="o">=</span>icc
<span class="nb">export</span><span class="w"> </span><span class="nv">CXX</span><span class="o">=</span>icpc
</pre></div>
</div>
<p>Install mpi4py in your <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> (e.g. in <code class="docutils literal notranslate"><span class="pre">~/Softwares</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>Softwares
<span class="nb">cd</span><span class="w"> </span>Softwares
wget<span class="w"> </span>https://github.com/mpi4py/mpi4py/releases/download/3.1.5/mpi4py-3.1.5.tar.gz
tar<span class="w"> </span>zxvf<span class="w"> </span>mpi4py-3.1.5.tar.gz
<span class="nb">cd</span><span class="w"> </span>mpi4py-3.1.5
python<span class="w"> </span>setup.py<span class="w"> </span>build
python<span class="w"> </span>setup.py<span class="w"> </span>install
<span class="c1"># Test on login node:</span>
mpiexec<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>python<span class="w"> </span>demo/helloworld.py
</pre></div>
</div>
<p>If you get a <code class="docutils literal notranslate"><span class="pre">CMake</span> <span class="pre">Error</span></code> when building mpi4py, you might need to use another intel compiler version. Load instead : intel/19.4.243 and intelmpi/19.4.243</p>
<p>Download and Install the MultiNest package in your <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> (e.g. in <code class="docutils literal notranslate"><span class="pre">~/Softwares</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/Softwares
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/farhanferoz/MultiNest.git<span class="w">  </span>./MultiNest
<span class="nb">cd</span><span class="w"> </span>MultiNest/MultiNest_v3.12_CMake/multinest/
mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>~/Softwares/MultiNest<span class="w"> </span><span class="se">\</span>
<span class="w">            </span>-DCMAKE_<span class="o">{</span>C,CXX<span class="o">}</span><span class="nv">_FLAGS</span><span class="o">=</span><span class="s2">&quot;-O3 -xCORE-AVX512 -mkl&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">            </span>-DCMAKE_Fortran_FLAGS<span class="o">=</span><span class="s2">&quot;-O3 -xCORE-AVX512 -mkl&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">            </span>-DCMAKE_C_COMPILER<span class="o">=</span>mpiicc<span class="w">    </span><span class="se">\</span>
<span class="w">            </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>mpiicpc<span class="w"> </span><span class="se">\</span>
<span class="w">            </span>-DCMAKE_Fortran_COMPILER<span class="o">=</span>mpiifort<span class="w">  </span>..
make

<span class="c1">## Check that libraries have been compiled and are present</span>
ls<span class="w"> </span>../lib
</pre></div>
</div>
<p>Install pymultinest in your <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> (e.g. in <code class="docutils literal notranslate"><span class="pre">~/Softwares</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/Softwares
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/JohannesBuchner/PyMultiNest.git<span class="w"> </span>./pymultinest
<span class="nb">cd</span><span class="w"> </span>pymultinest
python<span class="w"> </span>setup.py<span class="w"> </span>install

<span class="c1"># Add MultiNest to Library Path to test PyMultiNest (action to do for every job to run)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:<span class="nv">$HOME</span>/Softwares/MultiNest/MultiNest_v3.12_CMake/multinest/lib

<span class="c1"># Test pymultinest</span>
mpiexec<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>python<span class="w"> </span>pymultinest_demo.py
</pre></div>
</div>
<p>Clone and Install X-PSI in <code class="docutils literal notranslate"><span class="pre">~/Softwares</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/Softwares
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/xpsi-group/xpsi.git
<span class="nb">cd</span><span class="w"> </span>xpsi/
<span class="nv">LDSHARED</span><span class="o">=</span><span class="s2">&quot;icc -shared&quot;</span><span class="w"> </span><span class="nv">CC</span><span class="o">=</span>icc<span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>install

<span class="c1"># Test installation</span>
<span class="nb">cd</span><span class="w"> </span>~/
python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import xpsi&quot;</span>

<span class="c1">## Ignore the warnings about GetDist, NestCheck, CornerPlotter</span>
<span class="c1">##  which are only for PostProcessing (not usually performed on HPC systems).</span>
</pre></div>
</div>
<p>Set up your library paths:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:<span class="nv">$HOME</span>/Softwares/MultiNest/MultiNest_v3.12_CMake/multinest/lib
<span class="nb">export</span><span class="w"> </span><span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="nv">$MKLROOT</span>/lib/intel64/libmkl_core.so:<span class="nv">$MKLROOT</span>/lib/intel64/libmkl_sequential.so
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">module</span></code> commands, and the library path <code class="docutils literal notranslate"><span class="pre">commands</span></code> above will have to be added in your SBATCH script (see <a class="reference internal" href="Example_job.html#example-job"><span class="std std-ref">Example job</span></a>) to execute a run.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="applications.html" class="btn btn-neutral float-left" title="Publications" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="code_of_conduct.html" class="btn btn-neutral float-right" title="Code of Conduct" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2026 the X-PSI Core Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>